files:
    "/sbin/appstart" :
        mode: "000755"
        owner: webapp
        group: webapp
        content: |
            #!/usr/bin/env bash
            JAR_PATH=/var/app/current/application.jar

            # Datasource Conifg
            JDBC_URL=
            USERNAME=
            PASSWORD=
            DDL_AUTO="--spring.jpa.hibernate.ddl-auto=none"
            DATASOURCE_OPTS="--spring.datasource.hikari.jdbc-url=${JDBC_URL} --spring.datasource.hikari.username=${USERNAME} --spring.datasource.hikari.password=${PASSWORD}"

            # run app
            killall java
            java -Dfile.encoding=UTF-8 -jar $JAR_PATH DATASOURCE_OPTS $DDL_AUTO

container_commands:
  001-command:
      command: sed -i "s/JDBC_URL=/JDBC_URL=${SPRING_DATASOURCE_HIKARI_RDS_HOST}/g" /sbin/appstart
  002-command:
      command: sed -i "s/USERNAME=/USERNAME=${SPRING_DATASOURCE_HIKARI_USERNAME}/g" /sbin/appstart
  003-command:
      command: sed -i "s/PASSWORD=/PASSWORD=${SPRING_DATASOURCE_HIKARI_PASSWORD}/g" /sbin/appstart